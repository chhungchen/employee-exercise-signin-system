<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>郵件服務測試 - 員工運動簽到系統</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .status-card {
            transition: all 0.3s ease;
            border-left: 4px solid #6c757d;
        }
        .status-card.success {
            border-left-color: #28a745;
            background-color: #f8fff9;
        }
        .status-card.warning {
            border-left-color: #ffc107;
            background-color: #fffcf0;
        }
        .status-card.error {
            border-left-color: #dc3545;
            background-color: #fff5f5;
        }
        .log-container {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 0.375rem;
            max-height: 400px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
        }
        .log-entry {
            padding: 0.5rem;
            border-bottom: 1px solid #e9ecef;
        }
        .log-entry:last-child {
            border-bottom: none;
        }
        .log-entry.success {
            color: #155724;
            background-color: #d4edda;
        }
        .log-entry.error {
            color: #721c24;
            background-color: #f8d7da;
        }
        .log-entry.info {
            color: #0c5460;
            background-color: #d1ecf1;
        }
        .spinner-border-sm {
            width: 1rem;
            height: 1rem;
        }
        .service-status {
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            font-size: 0.875em;
            font-weight: 500;
        }
        .service-status.active {
            background-color: #d4edda;
            color: #155724;
        }
        .service-status.failed {
            background-color: #f8d7da;
            color: #721c24;
        }
        .service-status.available {
            background-color: #fff3cd;
            color: #856404;
        }
    </style>
</head>
<body class="bg-light">
    <div class="container mt-4">
        <div class="row">
            <div class="col-12">
                <h1 class="text-center mb-4">
                    <i class="fas fa-envelope-open-text text-primary"></i>
                    郵件服務測試中心
                </h1>
            </div>
        </div>

        <!-- 服務狀態總覽 -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card status-card" id="statusCard">
                    <div class="card-header">
                        <h5 class="mb-0">
                            <i class="fas fa-server"></i>
                            郵件服務狀態
                            <button class="btn btn-sm btn-outline-primary float-end" onclick="refreshStatus()">
                                <i class="fas fa-sync-alt" id="refreshIcon"></i>
                                刷新狀態
                            </button>
                        </h5>
                    </div>
                    <div class="card-body">
                        <div id="serviceStatus">
                            <div class="d-flex justify-content-center">
                                <div class="spinner-border" role="status">
                                    <span class="visually-hidden">載入中...</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 郵件測試表單 -->
        <div class="row mb-4">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0">
                            <i class="fas fa-paper-plane"></i>
                            郵件發送測試
                        </h5>
                    </div>
                    <div class="card-body">
                        <form id="emailTestForm">
                            <div class="mb-3">
                                <label for="testEmail" class="form-label">收件人郵箱</label>
                                <input type="email" class="form-control" id="testEmail" required
                                       placeholder="例如：test@example.com">
                            </div>
                            <div class="mb-3">
                                <label for="testType" class="form-label">測試類型</label>
                                <select class="form-select" id="testType">
                                    <option value="simple">簡單測試郵件</option>
                                    <option value="report">運動報告測試</option>
                                    <option value="notification">系統通知測試</option>
                                </select>
                            </div>
                            <div class="mb-3">
                                <label for="testSubject" class="form-label">自定義主旨（可選）</label>
                                <input type="text" class="form-control" id="testSubject"
                                       placeholder="預設會根據測試類型生成">
                            </div>
                            <button type="submit" class="btn btn-primary w-100" id="sendTestBtn">
                                <i class="fas fa-paper-plane"></i>
                                發送測試郵件
                            </button>
                        </form>
                    </div>
                </div>
            </div>

            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0">
                            <i class="fas fa-chart-line"></i>
                            健康檢查
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="d-grid gap-2">
                            <button class="btn btn-info" onclick="runHealthCheck()">
                                <i class="fas fa-heartbeat"></i>
                                執行完整健康檢查
                            </button>
                            <button class="btn btn-warning" onclick="testAllProviders()">
                                <i class="fas fa-network-wired"></i>
                                測試所有郵件提供者
                            </button>
                            <button class="btn btn-secondary" onclick="viewServiceLogs()">
                                <i class="fas fa-file-alt"></i>
                                查看服務日誌
                            </button>
                        </div>

                        <hr>

                        <h6>Render 部署檢查</h6>
                        <div class="d-grid gap-2">
                            <button class="btn btn-outline-success btn-sm" onclick="checkRenderConfig()">
                                <i class="fas fa-cog"></i>
                                檢查 Render 環境變數
                            </button>
                            <button class="btn btn-outline-info btn-sm" onclick="validateResendAPI()">
                                <i class="fas fa-key"></i>
                                驗證 Resend API 金鑰
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 執行日誌 -->
        <div class="row">
            <div class="col-12">
                <div class="card">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">
                            <i class="fas fa-terminal"></i>
                            執行日誌
                        </h5>
                        <button class="btn btn-sm btn-outline-secondary" onclick="clearLogs()">
                            <i class="fas fa-trash-alt"></i>
                            清除日誌
                        </button>
                    </div>
                    <div class="card-body p-0">
                        <div class="log-container" id="logContainer">
                            <div class="log-entry info">
                                <i class="fas fa-info-circle"></i>
                                [初始化] 郵件測試系統已就緒，請點擊「刷新狀態」檢查服務狀態
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 設定指南模態框 -->
        <div class="modal fade" id="configModal" tabindex="-1">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">
                            <i class="fas fa-cog"></i>
                            Render 環境變數配置指南
                        </h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body" id="configModalBody">
                        <!-- 動態載入配置指南內容 -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // 全域變數
        let logCounter = 0;

        // 頁面載入完成後初始化
        document.addEventListener('DOMContentLoaded', async function() {
            addLog('[初始化] 郵件測試系統已就緒，正在檢查認證狀態...', 'info');

            // 檢查認證狀態
            try {
                const token = await getAuthToken();
                if (token) {
                    addLog('✅ 認證驗證成功，開始載入服務狀態...', 'success');
                    refreshStatus();
                } else {
                    addLog('❌ 認證驗證失敗，請先登入管理員系統', 'error');
                }
            } catch (error) {
                addLog(`❌ 初始化過程發生錯誤: ${error.message}`, 'error');
            }

            // 綁定表單提交事件
            document.getElementById('emailTestForm').addEventListener('submit', function(e) {
                e.preventDefault();
                sendTestEmail();
            });
        });

        // 添加日誌條目
        function addLog(message, type = 'info') {
            const logContainer = document.getElementById('logContainer');
            const timestamp = new Date().toLocaleString('zh-TW');
            const logEntry = document.createElement('div');
            logEntry.className = `log-entry ${type}`;

            let icon;
            switch(type) {
                case 'success':
                    icon = 'fas fa-check-circle';
                    break;
                case 'error':
                    icon = 'fas fa-exclamation-circle';
                    break;
                case 'warning':
                    icon = 'fas fa-exclamation-triangle';
                    break;
                default:
                    icon = 'fas fa-info-circle';
            }

            logEntry.innerHTML = `<i class="${icon}"></i> [${timestamp}] ${message}`;
            logContainer.appendChild(logEntry);
            logContainer.scrollTop = logContainer.scrollHeight;

            logCounter++;
        }

        // 檢查登入狀態並獲取 Token
        async function getAuthToken() {
            try {
                // 檢查 localStorage 中是否有 token
                let token = localStorage.getItem('adminToken');
                if (token) {
                    // 驗證 token 是否仍然有效
                    const verifyResponse = await fetch('/api/admin/verify', {
                        headers: { 'Authorization': `Bearer ${token}` }
                    });
                    if (verifyResponse.ok) {
                        return token;
                    }
                }

                // 如果沒有有效 token，嘗試使用管理員頁面的認證
                const adminLoginResponse = await fetch('/api/admin/verify', {
                    credentials: 'include' // 包含 cookies
                });

                if (adminLoginResponse.ok) {
                    const adminData = await adminLoginResponse.json();
                    if (adminData.token) {
                        localStorage.setItem('adminToken', adminData.token);
                        return adminData.token;
                    }
                }

                // 如果都失敗，重新導向到登入頁面
                addLog('❌ 需要管理員登入，正在重新導向...', 'error');
                setTimeout(() => {
                    window.location.href = '/admin';
                }, 2000);
                return null;

            } catch (error) {
                addLog(`❌ 認證檢查失敗: ${error.message}`, 'error');
                return null;
            }
        }

        // 刷新服務狀態
        async function refreshStatus() {
            const refreshIcon = document.getElementById('refreshIcon');
            const statusCard = document.getElementById('statusCard');
            const serviceStatus = document.getElementById('serviceStatus');

            refreshIcon.classList.add('fa-spin');
            addLog('正在檢查郵件服務狀態...', 'info');

            try {
                // 獲取認證 Token
                const token = await getAuthToken();
                if (!token) {
                    throw new Error('需要提供認證Token');
                }

                const response = await fetch('/api/admin/email-status', {
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    },
                    credentials: 'include'
                });

                const data = await response.json();

                if (response.ok) {
                    displayServiceStatus(data);
                    statusCard.className = 'card status-card success';
                    addLog('✅ 服務狀態檢查完成', 'success');
                } else {
                    if (response.status === 401) {
                        // Token 過期，清除並重新導向
                        localStorage.removeItem('adminToken');
                        throw new Error('認證已過期，請重新登入');
                    }
                    throw new Error(data.message || '狀態檢查失敗');
                }
            } catch (error) {
                serviceStatus.innerHTML = `
                    <div class="alert alert-danger">
                        <i class="fas fa-exclamation-triangle"></i>
                        無法獲取服務狀態: ${error.message}
                        ${error.message.includes('認證') ? '<br><small>將在 3 秒後重新導向到管理員登入頁面...</small>' : ''}
                    </div>
                `;
                statusCard.className = 'card status-card error';
                addLog(`❌ 服務狀態檢查失敗: ${error.message}`, 'error');

                if (error.message.includes('認證') || error.message.includes('登入')) {
                    setTimeout(() => {
                        window.location.href = '/admin';
                    }, 3000);
                }
            } finally {
                refreshIcon.classList.remove('fa-spin');
            }
        }

        // 顯示服務狀態
        function displayServiceStatus(data) {
            const serviceStatus = document.getElementById('serviceStatus');

            let html = `
                <div class="row">
                    <div class="col-md-6">
                        <h6>服務概況</h6>
                        <p><strong>初始化狀態：</strong>
                            ${data.initialized ? '<span class="badge bg-success">已初始化</span>' : '<span class="badge bg-danger">未初始化</span>'}
                        </p>
                        <p><strong>當前提供者：</strong> ${data.currentProvider || '無'}</p>
                        <p><strong>可用提供者：</strong> ${data.availableProviders} 個</p>
                        <p><strong>失敗提供者：</strong> ${data.failedProviders.length} 個</p>
                    </div>
                    <div class="col-md-6">
                        <h6>提供者詳情</h6>
                        <div class="provider-list">
            `;

            if (data.providerDetails && data.providerDetails.length > 0) {
                data.providerDetails.forEach(provider => {
                    const statusClass = provider.status === 'active' ? 'active' :
                                       provider.status === 'failed' ? 'failed' : 'available';

                    html += `
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <span>${provider.name}</span>
                            <span class="service-status ${statusClass}">${provider.status}</span>
                        </div>
                    `;
                });
            } else {
                html += '<p class="text-muted">無可用提供者</p>';
            }

            html += `
                        </div>
                    </div>
                </div>
            `;

            // 如果是 Render 環境且沒有可用的 HTTP API 服務，顯示配置提示
            if (data.isRender && data.availableProviders === 0) {
                html += `
                    <div class="alert alert-warning mt-3">
                        <h6><i class="fas fa-exclamation-triangle"></i> Render 環境配置提醒</h6>
                        <p>檢測到您在 Render 環境中，但沒有配置 HTTP API 郵件服務。請：</p>
                        <ol>
                            <li>註冊 <a href="https://resend.com/" target="_blank">Resend</a> 帳號</li>
                            <li>在 Render Dashboard 設定 <code>RESEND_API_KEY</code> 環境變數</li>
                            <li>設定 <code>EMAIL_FROM</code> 為您驗證的發送者地址</li>
                        </ol>
                        <button class="btn btn-sm btn-info" onclick="showConfigGuide()">
                            <i class="fas fa-book"></i> 查看詳細配置指南
                        </button>
                    </div>
                `;
            }

            serviceStatus.innerHTML = html;
        }

        // 發送測試郵件
        async function sendTestEmail() {
            const sendBtn = document.getElementById('sendTestBtn');
            const email = document.getElementById('testEmail').value;
            const type = document.getElementById('testType').value;
            const subject = document.getElementById('testSubject').value;

            sendBtn.disabled = true;
            sendBtn.innerHTML = '<span class="spinner-border spinner-border-sm"></span> 發送中...';

            addLog(`📧 開始發送測試郵件到 ${email}...`, 'info');

            try {
                // 獲取認證 Token
                const token = await getAuthToken();
                if (!token) {
                    throw new Error('需要提供認證Token');
                }

                const response = await fetch('/api/admin/test-email', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    credentials: 'include',
                    body: JSON.stringify({
                        email: email,
                        testType: type,
                        subject: subject
                    })
                });

                const data = await response.json();

                if (response.ok) {
                    if (data.success && data.data) {
                        addLog(`✅ 郵件發送成功！`, 'success');
                        addLog(`📧 收件人: ${data.data.recipient}`, 'info');
                        addLog(`📨 訊息 ID: ${data.data.messageId || 'N/A'}`, 'info');
                        addLog(`🔗 使用提供者: ${data.data.provider || 'N/A'}`, 'info');
                        addLog(`📅 發送時間: ${new Date(data.data.sentAt).toLocaleString('zh-TW', { timeZone: 'Asia/Taipei' })}`, 'info');
                    } else {
                        addLog(`⚠️ 郵件發送回應異常: ${data.message || '未知狀態'}`, 'warning');
                    }
                } else {
                    if (response.status === 401) {
                        localStorage.removeItem('adminToken');
                        throw new Error('認證已過期，請重新登入');
                    }
                    throw new Error(data.message || '郵件發送失敗');
                }
            } catch (error) {
                addLog(`❌ 郵件發送失敗: ${error.message}`, 'error');
                if (error.message.includes('認證') || error.message.includes('登入')) {
                    setTimeout(() => {
                        window.location.href = '/admin';
                    }, 3000);
                }
            } finally {
                sendBtn.disabled = false;
                sendBtn.innerHTML = '<i class="fas fa-paper-plane"></i> 發送測試郵件';
            }
        }

        // 執行健康檢查
        async function runHealthCheck() {
            addLog('🔍 開始執行完整健康檢查...', 'info');

            try {
                const response = await fetch('/api/email/health-check');
                const data = await response.json();

                if (response.ok) {
                    addLog('✅ 健康檢查完成', 'success');

                    // 顯示環境資訊
                    if (data.environment) {
                        addLog(`🌍 平台環境: ${data.environment.platform}`, 'info');
                        addLog(`⚙️ 執行環境: ${data.environment.nodeEnv}`, 'info');
                    }

                    // 顯示健康狀態
                    if (data.health) {
                        const healthIcon = data.health.status === 'healthy' ? '🟢' :
                                         data.health.status === 'warning' ? '🟡' : '🔴';
                        addLog(`${healthIcon} 系統健康度: ${data.health.status} (${data.health.score}/100)`,
                               data.health.status === 'healthy' ? 'success' : 'warning');
                        addLog(`💬 ${data.health.message}`, 'info');
                    }

                    // 顯示提供者狀態
                    if (data.providers) {
                        addLog('📋 郵件提供者狀態:', 'info');
                        Object.entries(data.providers).forEach(([name, provider]) => {
                            const status = provider.status === 'ready' ? '✅' :
                                         provider.status === 'not_configured' ? '⚠️' :
                                         provider.status === 'blocked_by_platform' ? '🚫' : '❌';
                            addLog(`  ${status} ${provider.name}: ${provider.status}`,
                                   provider.status === 'ready' ? 'success' : 'info');
                        });
                    }

                    // 顯示建議
                    if (data.recommendations && data.recommendations.length > 0) {
                        addLog('💡 系統建議:', 'info');
                        data.recommendations.forEach(rec => {
                            const priority = rec.priority === 'high' ? '🔥' : '💡';
                            addLog(`  ${priority} ${rec.message}`, 'info');
                        });
                    }

                } else {
                    throw new Error(data.message || '健康檢查失敗');
                }
            } catch (error) {
                addLog(`❌ 健康檢查失敗: ${error.message}`, 'error');
            }
        }

        // 測試所有提供者
        async function testAllProviders() {
            addLog('🔄 開始測試所有郵件提供者...', 'info');

            try {
                // 獲取認證 Token
                const token = await getAuthToken();
                if (!token) {
                    throw new Error('需要提供認證Token');
                }

                const response = await fetch('/api/admin/test-all-providers', {
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    },
                    credentials: 'include'
                });

                const data = await response.json();

                if (response.ok) {
                    addLog('✅ 提供者測試完成', 'success');

                    if (data.results && Array.isArray(data.results)) {
                        data.results.forEach(result => {
                            const status = result.success ? '✅' : '❌';
                            addLog(`${status} ${result.provider}: ${result.message} (${result.responseTime}ms)`,
                                   result.success ? 'success' : 'error');
                        });

                        // 顯示總結
                        const summary = data.summary;
                        addLog(`📊 測試總結: ${summary.successfulTests}/${summary.availableProviders} 個提供者可用`, 'info');
                    }
                } else {
                    if (response.status === 401) {
                        localStorage.removeItem('adminToken');
                        throw new Error('認證已過期，請重新登入');
                    }
                    throw new Error(data.message || '提供者測試失敗');
                }
            } catch (error) {
                addLog(`❌ 提供者測試失敗: ${error.message}`, 'error');
                if (error.message.includes('認證') || error.message.includes('登入')) {
                    setTimeout(() => {
                        window.location.href = '/admin';
                    }, 3000);
                }
            }
        }

        // 檢查 Render 配置
        async function checkRenderConfig() {
            addLog('🔍 檢查 Render 環境變數配置...', 'info');

            try {
                // 獲取認證 Token
                const token = await getAuthToken();
                if (!token) {
                    throw new Error('需要提供認證Token');
                }

                const response = await fetch('/api/admin/check-render-config', {
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    },
                    credentials: 'include'
                });

                const data = await response.json();

                if (response.ok) {
                    addLog('✅ Render 配置檢查完成', 'success');

                    if (data.config) {
                        addLog(`📍 檢測到平台: ${data.config.platform}`, 'info');

                        // 顯示必需變數狀態
                        if (data.config.environment.requiredVariables) {
                            data.config.environment.requiredVariables.forEach(v => {
                                const status = v.configured ? '✅' : '❌';
                                addLog(`${status} ${v.name}: ${v.configured ? '已配置' : '未配置'}`, v.configured ? 'success' : 'error');
                            });
                        }

                        // 顯示建議
                        if (data.config.recommendations && data.config.recommendations.length > 0) {
                            data.config.recommendations.forEach(rec => {
                                const priority = rec.priority === 'critical' ? '🚨' : rec.priority === 'high' ? '⚠️' : '💡';
                                addLog(`${priority} ${rec.message}`, rec.priority === 'critical' ? 'error' : 'info');
                            });
                        }
                    }
                } else {
                    if (response.status === 401) {
                        localStorage.removeItem('adminToken');
                        throw new Error('認證已過期，請重新登入');
                    }
                    throw new Error(data.message || 'Render 配置檢查失敗');
                }
            } catch (error) {
                addLog(`❌ Render 配置檢查失敗: ${error.message}`, 'error');
                if (error.message.includes('認證') || error.message.includes('登入')) {
                    setTimeout(() => {
                        window.location.href = '/admin';
                    }, 3000);
                }
            }
        }

        // 驗證 Resend API
        async function validateResendAPI() {
            addLog('🔑 驗證 Resend API 金鑰...', 'info');

            try {
                // 獲取認證 Token
                const token = await getAuthToken();
                if (!token) {
                    throw new Error('需要提供認證Token');
                }

                const response = await fetch('/api/admin/validate-resend', {
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    },
                    credentials: 'include'
                });

                const data = await response.json();

                if (response.ok) {
                    if (data.success) {
                        addLog('✅ Resend API 金鑰驗證成功', 'success');
                        addLog(`📋 金鑰預覽: ${data.keyPreview}`, 'info');
                        if (data.note) {
                            addLog(`💡 ${data.note}`, 'info');
                        }
                    } else {
                        addLog('❌ Resend API 金鑰驗證失敗', 'error');
                        addLog(`   ${data.message}`, 'error');
                        if (data.keyPreview) {
                            addLog(`📋 金鑰預覽: ${data.keyPreview}`, 'info');
                        }
                    }
                } else {
                    if (response.status === 401) {
                        localStorage.removeItem('adminToken');
                        throw new Error('認證已過期，請重新登入');
                    }
                    throw new Error(data.message || 'Resend API 驗證失敗');
                }
            } catch (error) {
                addLog(`❌ Resend API 驗證失敗: ${error.message}`, 'error');
                if (error.message.includes('認證') || error.message.includes('登入')) {
                    setTimeout(() => {
                        window.location.href = '/admin';
                    }, 3000);
                }
            }
        }

        // 查看服務日誌
        function viewServiceLogs() {
            addLog('服務日誌功能開發中...', 'info');
            // TODO: 實作服務日誌查看功能
        }

        // 顯示配置指南
        function showConfigGuide() {
            const modal = new bootstrap.Modal(document.getElementById('configModal'));
            const modalBody = document.getElementById('configModalBody');

            modalBody.innerHTML = `
                <h6>1. 註冊 Resend 帳號</h6>
                <p>前往 <a href="https://resend.com/" target="_blank">https://resend.com/</a> 註冊免費帳號（每月 3000 封免費額度）</p>

                <h6>2. 獲取 API 金鑰</h6>
                <ol>
                    <li>登入 Resend Dashboard</li>
                    <li>前往 API Keys 頁面</li>
                    <li>點擊 "Create API Key"</li>
                    <li>選擇 "Sending access" 權限</li>
                    <li>複製生成的 API 金鑰</li>
                </ol>

                <h6>3. 配置 Render 環境變數</h6>
                <ol>
                    <li>進入 Render Dashboard</li>
                    <li>選擇您的服務</li>
                    <li>前往 Environment 頁面</li>
                    <li>添加以下環境變數：</li>
                </ol>

                <div class="bg-light p-3 rounded">
                    <code>
                        RESEND_API_KEY=re_xxxxxxxxxxxxxxxxxxxxxxxxxxxx<br>
                        EMAIL_FROM=noreply@yourdomain.com
                    </code>
                </div>

                <div class="alert alert-info mt-3">
                    <strong>注意：</strong> EMAIL_FROM 必須是您在 Resend 中驗證的網域或使用 Resend 的測試網域
                </div>

                <h6>4. 重新部署服務</h6>
                <p>在 Render Dashboard 中點擊 "Manual Deploy" 重新部署您的服務</p>
            `;

            modal.show();
        }

        // 清除日誌
        function clearLogs() {
            const logContainer = document.getElementById('logContainer');
            logContainer.innerHTML = `
                <div class="log-entry info">
                    <i class="fas fa-info-circle"></i>
                    [清除] 日誌已清除
                </div>
            `;
            logCounter = 0;
        }
    </script>
</body>
</html>